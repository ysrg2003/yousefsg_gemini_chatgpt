name: ChatGPT Simple API
on:
  workflow_dispatch:
    inputs:
      prompt:
        required: true
        type: string

jobs:
  run-system:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ Checkout Code
        uses: actions/checkout@v4
      
      - name: ğŸ Set up Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: ğŸ“¥ Download & Inject Assets
        run: |
          echo "ğŸ“¥ Ø³Ø­Ø¨ Ø§Ù„ØªØ±Ø³Ø§Ù†Ø© Ø§Ù„Ù…Ø¶ØºÙˆØ·Ø© Ø¨Ù€ Zstd..."
          gh release download v1.0.0 -p "vendor_assets.tar.zst"
          
          echo "âš¡ ÙÙƒ Ø§Ù„Ø¶ØºØ· ÙØ§Ø¦Ù‚ Ø§Ù„Ø³Ø±Ø¹Ø©..."
          mkdir -p .temp_vendor
          tar -I zstd -xf vendor_assets.tar.zst -C .
          
          echo "ğŸ”— Ø±Ø¨Ø· Ø§Ù„Ù…Ø­Ø±Ùƒ..."
          mkdir -p /home/runner/.cache
          ln -sf $(pwd)/camoufox_cache /home/runner/.cache/camoufox
          
          chmod -R +x /home/runner/.cache/camoufox 2>/dev/null || true
          chmod -R +x browsers/ 2>/dev/null || true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: ğŸš€ Run ChatGPT Automation
        env:
          # ØªÙ… ØªØºÙŠÙŠØ± Ø§Ø³Ù… Ø§Ù„Ø³ÙƒØ±Øª Ù„ÙŠØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ ChatGPT
          GPT_COOKIES: ${{ secrets.GPT_COOKIES }}
          PYTHONPATH: ${{ github.workspace }}/python
          PLAYWRIGHT_BROWSERS_PATH: ${{ github.workspace }}/browsers
          CAMOUFOX_CACHE_DIR: /home/runner/.cache/camoufox
        run: |
          echo "ğŸ¬ ØªØ´ØºÙŠÙ„ Ù…Ø­Ø±Ùƒ ChatGPT..."
          # ØªØ´ØºÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø¨Ø§ÙŠØ«ÙˆÙ† Ø§Ù„Ù…Ø®ØµØµ Ù„Ù€ ChatGPT
          python main_gpt.py "${{ github.event.inputs.prompt }}"

      - name: ğŸ“¤ Upload Result
        if: always()
        uses: actions/upload-artifact@v4
        with:
          # ØªÙ… ØªØºÙŠÙŠØ± Ø§Ø³Ù… Ø§Ù„Ø£Ø±ØªÙŠÙØ§ÙƒØª Ù„ØªÙ…ÙŠÙŠØ² Ù†ØªØ§Ø¦Ø¬ ChatGPT
          name: gpt-json
          path: gpt_result.json
