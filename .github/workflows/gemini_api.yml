name: Gemini Simple API

on:
  workflow_dispatch:
    inputs:
      prompt:
        description: 'ูุต ุงูุณุคุงู ุงููุฑุณู ููููุฏูู'
        required: true
        type: string
      request_id:
        description: 'ุฑูู ุชุชุจุน ุงูุทูุจ ูููุน ุงูุชุฏุงุฎู'
        required: true
        type: string

jobs:
  run-system:
    runs-on: ubuntu-latest
    steps:
      - name: ๐ Checkout Code
        uses: actions/checkout@v4
      
      - name: ๐ Set up Python 3.11
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: ๐ฅ Download & Inject Assets
        run: |
          echo "๐ฅ ุณุญุจ ุงูุชุฑุณุงูุฉ ุงููุถุบูุทุฉ ุจู Zstd..."
          # ุชุญููู ุงูููู ูู ุงูุฅุตุฏุงุฑ (Release)
          gh release download v1.0.0 -p "vendor_assets.tar.zst"
          
          echo "โก ูู ุงูุถุบุท ูุงุฆู ุงูุณุฑุนุฉ..."
          mkdir -p .temp_vendor
          tar -I zstd -xf vendor_assets.tar.zst -C .
          
          echo "๐ ุฑุจุท ุงููุญุฑู ุจุงูุจูุฆุฉ..."
          mkdir -p /home/runner/.cache
          ln -sf $(pwd)/camoufox_cache /home/runner/.cache/camoufox
          
          # ุชุฃูุฏ ูู ุตูุงุญูุงุช ุงูุชูููุฐ ูููููุงุช ุงููุณุชุฎุฑุฌุฉ
          chmod -R +x /home/runner/.cache/camoufox 2>/dev/null || true
          chmod -R +x browsers/ 2>/dev/null || true
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: ๐ Run Automation
        env:
          GEMINI_COOKIES: ${{ secrets.GEMINI_COOKIES }}
          # ุชุนุฑูู ูุณุงุฑุงุช ุงูููุชุจุงุช ูุงููุญุฑูุงุช ุงูุชู ุชู ูู ุถุบุทูุง
          PYTHONPATH: ${{ github.workspace }}/python
          PLAYWRIGHT_BROWSERS_PATH: ${{ github.workspace }}/browsers
          CAMOUFOX_CACHE_DIR: /home/runner/.cache/camoufox
        run: |
          echo "๐ฌ ุชุดุบูู ุงููุญุฑู ุงูุฑุฆูุณู ูู Gemini..."
          # ุชูุฑูุฑ ุงูุจุฑููุจุช ููููู ุงูุฑุฆูุณู
          python main.py "${{ inputs.prompt }}"

      - name: ๐ฆ Upload Result
        if: always()
        uses: actions/upload-artifact@v4
        with:
          # ุงูุชุทููุฑ ุงูุฃุณุงุณู: ุงุณู ุงูุฃุฑุชููุงูุช ูุญุชูู ุนูู ุงูู Request ID ูุถูุงู ุนุฏู ุงูุชุฏุงุฎู
          name: gemini-json-${{ inputs.request_id }}
          path: gemini_result.json
          retention-days: 1 # ุชูููู ูุชุฑุฉ ุงูุงุญุชูุงุธ ูุชูููุฑ ุงููุณุงุญุฉ
